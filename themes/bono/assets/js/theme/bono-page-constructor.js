!function(e){"function"==typeof define&&define.amd?define("bonoPageConstructor",e):e()}((function(){"use strict";jQuery((function(e){var t,o=".customize-control-bono-page-constructor";function i(t){var i=t.parents(o),n=i.find(".bono-customize-pc-items"),c=i.find(".bono-customize-pc-field"),s=[];setTimeout((function(){n.find(".bono-customize-pc-item").each((function(){var t=e(this),o={};t.find("input, textarea, select").each((function(){var t=e(this),i=t.val();"checkbox"===t.attr("type")&&(i=t.is(":checked")),o[t.attr("name")]=i})),s.push(o)})),c.val(JSON.stringify(s)).trigger("change")}),50)}e(".bono-customize-pc-items").sortable({handle:".bono-customize-pc-item-header",axis:"y",update:function(t,o){i(e(this).find("input:first"))}}),e(document).on("change",".bono-customize-pc-item input, .bono-customize-pc-item select, .bono-customize-pc-item textarea",(function(){i(e(this))})),e(document).on("keyup",".bono-customize-pc-item input, .bono-customize-pc-item textarea",(function(){var o=e(this);clearTimeout(t),t=setTimeout((function(){i(o)}),500)})),e(document).on("keyup",".bono-customize-pc-item input[name=section_header_text]",(function(){var t=e(this);t.parents(".bono-customize-pc-item").find(".bono-customize-pc-item-header em").text(t.val())})),e(document).on("click",".bono-customize-pc-preset",(function(){var t=e(this),o=t.parent();o.find(".bono-customize-pc-preset").removeClass("active"),t.addClass("active"),o.find("input[name=preset]").val(t.data("preset-name")).change()})),e(document).on("click",".bono-customize-pc-item-header",(function(){e(this).parent().find(".bono-customize-pc-item-body").slideToggle()})),e(".js-bono-customize-pc-add").on("click",(function(){var t=e(this),n=t.parents(o),c=n.find(".bono-customize-pc-items"),s=t.data("type"),a=n.find(".bono-customize-pc-placeholders .bono-customize-pc-item[data-type="+s+"]").clone();c.append(a),i(c.find("input:first"))})),e(document).on("click",".js-bono-customize-pc-delete",(function(){var t=e(this),n=t.parents(o).find(".bono-customize-pc-items");t.parents(".bono-customize-pc-item").remove(),i(n)})),e(document).on("click",".bono-customize-pc-post-card-settings-open",(function(){e(this).parents(".bono-customize-pc-item").find(".bono-customize-pc-post-card-settings").slideToggle()})),function(e){function t(e){e.slideToggle(150)}function n(e){var t=e.closest(".js-bono-customize-pc-slider-item").find(".js-bono-customize-pc-slide-item-id"),o=e.closest(".js-bono-customize-pc-slider-item").find(".js-bono-customize-pc-slide-item-media");switch(e.val()){case"post":case"product":case"category":t.show(),o.hide();break;default:t.hide(),o.show()}}e(o).find(".bono-customize-pc-items .js-bono-customize-pc-slider-items").each((function(){var t=e(this),i=t.data("items");if(Object.keys(i).length){var c=0,s=e(this).parents(o);e.each(i,(function(o,i){var a=s.find(".bono-customize-pc-placeholders .js-bono-customize-pc-slider-item").clone();a.find("input, textarea, select").each((function(){var t=e(this);if(t.attr("name")&&(t.attr("name",t.attr("name").replace("{{n}}",o)),e.each(i,(function(e,i){var n="slide_items["+o+"]["+e+"]";t.attr("name")===n&&t.val(i)}))),t.hasClass("js-bono-customize-pc-slide-item-type")&&n(t),t.hasClass("js-bono-customize-pc-slide-item-header")){var c="Slide";""!==t.val()&&(c=t.val()),t.parents(".js-bono-customize-pc-slider-item").find(".js-bono-customize-pc-item--slide-header strong").text(c)}})),c=Math.max(c,o),t.append(a),t.data("item_number",c)}))}})),e(document).on("click",".js-bono-customize-pc-add-slide-item",(function(){var t=e(this),n=t.parents(o),c=t.parents(".bono-customize-pc-item--slider").find(".js-bono-customize-pc-slider-items"),s=parseInt(c.data("item_number")||0);s++;var a=n.find(".bono-customize-pc-placeholders .js-bono-customize-pc-slider-item").clone();a.find("input, textarea, select").each((function(){var t=e(this);t.attr("name")&&t.attr("name",t.attr("name").replace("{{n}}",s))})),a.find(".js-bono-customize-pc-item--slide-content").show(),c.append(a),c.data("item_number",s),i(c.find("input:first"))})),e(document).on("click",".js-bono-customize-pc-toggle-slide-item",(function(){t(e(this).closest(".js-bono-customize-pc-item--slide-content"))})),e(document).on("click",".js-bono-customize-pc-item--slide-header",(function(){t(e(this).closest(".js-bono-customize-pc-slider-item").find(".js-bono-customize-pc-item--slide-content"))})),e(document).on("click",".js-bono-customize-pc-delete-slide-item",(function(){var t=e(this),n=t.parents(o).find(".bono-customize-pc-items");t.closest(".js-bono-customize-pc-slider-item").remove(),i(n)})),e(document).on("change",".js-bono-customize-pc-slide-item-type",(function(){n(e(this))})),e(document).on("click",".js-bono-customize-pc-slide-item-media-browse",(function(){var t=e(this),n=t.parents(o).find(".bono-customize-pc-items"),c=wp.media.frames.file_frame=wp.media({title:t.data("uploader_title"),button:{text:t.data("uploader_button_text")},multiple:!1});c.on("select",(function(){var e=c.state().get("selection").first().toJSON();t.parent().find('input[type="text"]').val(e.url),i(n)})),c.open()})),e(".bono-customize-pc-slider-items").sortable({axis:"y",update:function(t,o){i(e(this).find("input:first"))}}),e(document).on("keyup",".js-bono-customize-pc-slide-item-header",(function(){var t=e(this),o="Slide";""!==t.val()&&(o=t.val()),t.parents(".js-bono-customize-pc-slider-item").find(".js-bono-customize-pc-item--slide-header strong").text(o)}))}(e)}))}));